{% extends 'base.html' %}

{% block title %}Quiz Question{% endblock %}

{% block content %}
<div class="question-container">
    <div class="quiz-card card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div class="progress-info">
                <span class="level-badge">Level: {{ level }}</span>
                <span class="question-count">Question: {{ question_num }}/{{ total_questions }}</span>
            </div>
            <div id="timer" class="timer-badge">30</div>
        </div>
        <div class="card-body">
            <h3 class="card-title question-text">{{ question }}</h3>
            
            <form id="answerForm" method="post" action="{{ url_for('main.submit_answer') }}">
                <input type="hidden" name="time_taken" id="timeTaken" value="0">
                <input type="hidden" name="answer" id="selectedAnswer" value="">
                
                <div class="options-container">
                    {% for option in options %}
                    <div class="option-item" data-value="{{ option }}">
                        <div class="option-content">
                            <span class="option-letter">{{ ['A', 'B', 'C', 'D'][loop.index0] }}</span>
                            <span class="option-text">{{ option }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="action-buttons mt-4">
                    <button type="submit" id="submitBtn" class="btn btn-primary btn-lg" disabled>
                        Submit Answer <i class="fas fa-paper-plane ms-2"></i>
                    </button>
                    <a href="{{ url_for('main.skip_question') }}" class="btn btn-outline-secondary btn-lg ms-2">
                        Skip Question <i class="fas fa-forward ms-2"></i>
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!--
    <div class="alert alert-warning mt-4">
        <div class="d-flex">
            <i class="fas fa-exclamation-triangle me-3"></i>
            <div>
                <strong>Important:</strong> Please do not refresh this page. Refreshing will end your current quiz and you'll need to start over.
            </div>
        </div>
    </div> 
    -->
</div>
{% endblock %}

{% block scripts %}
<script>
    // Handle option selection
    document.addEventListener('DOMContentLoaded', function() {
        const optionItems = document.querySelectorAll('.option-item');
        const selectedAnswerInput = document.getElementById('selectedAnswer');
        const submitBtn = document.getElementById('submitBtn');
        
        optionItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove selected class from all options
                optionItems.forEach(opt => opt.classList.remove('option-selected'));
                
                // Add selected class to clicked option
                this.classList.add('option-selected');
                
                // Set the selected value
                const selectedValue = this.getAttribute('data-value');
                selectedAnswerInput.value = selectedValue;
                
                // Enable submit button
                submitBtn.disabled = false;
            });
        });
        
        // Check if an option is already selected (for browser back/forward)
        if (selectedAnswerInput.value) {
            optionItems.forEach(item => {
                if (item.getAttribute('data-value') === selectedAnswerInput.value) {
                    item.classList.add('option-selected');
                    submitBtn.disabled = false;
                }
            });
        }
    });

    // Timer functionality
    let timeLeft = 30;
    const timerElement = document.getElementById('timer');
    const timeTakenInput = document.getElementById('timeTaken');
    const form = document.getElementById('answerForm');
    
    const timer = setInterval(function() {
        timeLeft--;
        timerElement.textContent = timeLeft;
        timeTakenInput.value = 30 - timeLeft;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            // Only auto-submit if an option is selected
            const submitBtn = document.getElementById('submitBtn');
            if (!submitBtn.disabled) {
                form.submit(); // Auto-submit when time is up and an option is selected
            } else {
                // If no option selected when time runs out, skip the question
                window.location.href = "{{ url_for('main.skip_question') }}";
            }
        }
        
        // Change color when time is running out
        if (timeLeft <= 10) {
            timerElement.classList.add('timer-warning');
        } else {
            timerElement.classList.remove('timer-warning');
        }
        
        // Pulsing animation when time is critical
        if (timeLeft <= 5) {
            timerElement.classList.add('timer-critical');
        } else {
            timerElement.classList.remove('timer-critical');
        }
    }, 1000);
</script>

<style>
    .question-container {
        padding: 1rem 0;
    }
    
    .quiz-card {
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(67, 97, 238, 0.15);
        overflow: hidden;
    }
    
    .quiz-card .card-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        font-weight: 600;
        border: none;
        padding: 1rem 1.5rem;
    }
    
    .progress-info {
        display: flex;
        gap: 1rem;
    }
    
    .level-badge, .question-count {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    
    .timer-badge {
        background: var(--background);
        color: var(--primary);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: bold;
        font-size: 1.1rem;
        min-width: 50px;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .timer-warning {
        background: var(--warning);
        color: var(--dark);
        animation: pulse 1s infinite;
    }
    
    .timer-critical {
        animation: pulse 0.5s infinite;
    }
    
    .card-body {
        padding: 2rem;
    }
    
    .question-text {
        color: var(--text-primary);
        margin-bottom: 2rem;
        font-weight: 600;
        line-height: 1.4;
    }
    
    .options-container {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
    }
    
    .option-item {
        border: 2px solid rgba(67, 97, 238, 0.1);
        border-radius: var(--border-radius);
        padding: 0.75rem 1.25rem;
        transition: var(--transition);
        background: var(--card-bg);
        cursor: pointer;
    }
    
    .option-item:hover {
        border-color: var(--primary);
        transform: translateX(5px);
    }
    
    .option-selected {
        border-color: var(--primary) !important;
        background: rgba(67, 97, 238, 0.1) !important;
    }
    
    .option-content {
        display: flex;
        align-items: center;
    }
    
    .option-letter {
        background: var(--primary);
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 1rem;
        flex-shrink: 0;
        font-size: 0.9rem;
    }
    
    .option-selected .option-letter {
        background: var(--secondary);
    }
    
    .option-text {
        flex-grow: 1;
        font-size: 1rem;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
    }
    
    .alert-warning {
        background: linear-gradient(135deg, #fff3cd 0%, #ffecb5 100%);
        border: 1px solid #ffc107;
        border-radius: var(--border-radius);
        color: #856404;
        padding: 1rem 1.5rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .card-body {
            padding: 1.5rem;
        }
        
        .progress-info {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .action-buttons .btn {
            width: 100%;
            margin-left: 0 !important;
        }
        
        .option-item {
            padding: 0.6rem 1rem;
        }
    }
    
    @media (max-width: 576px) {
        .card-body {
            padding: 1.25rem;
        }
        
        .question-text {
            font-size: 1.25rem;
        }
        
        .option-letter {
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            margin-right: 0.8rem;
        }
        
        .option-text {
            font-size: 0.95rem;
        }
    }
</style>
{% endblock %}