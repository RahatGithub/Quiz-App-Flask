<!-- app/templates/quiz/question.html -->
{% extends 'base.html' %}

{% block title %}Quiz Question{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>Level: {{ level }} | Question: {{ question_num }}/{{ total_questions }}</div>
        <div id="timer" class="badge bg-primary">30</div>
    </div>
    <div class="card-body">
        <h5 class="card-title">{{ question }}</h5>
        
        <form id="answerForm" method="post" action="{{ url_for('main.submit_answer') }}">
            <input type="hidden" name="time_taken" id="timeTaken" value="0">
            
            {% for option in options %}
            <div class="form-check mb-2">
                <input class="form-check-input answer-option" type="radio" name="answer" id="option{{ loop.index }}" value="{{ option }}" onchange="checkSelection()">
                <label class="form-check-label" for="option{{ loop.index }}">
                    {{ option }}
                </label>
            </div>
            {% endfor %}
            
            <div class="mt-3 d-flex">
                <button type="submit" id="submitBtn" class="btn btn-primary" disabled>Submit Answer</button>
                <a href="{{ url_for('main.skip_question') }}" class="btn btn-secondary ms-2">Skip Question</a>
            </div>
        </form>
    </div>
</div>

<div class="alert alert-warning mb-3">
    <strong>Important:</strong> Please do not refresh this page. Refreshing will end your current quiz and you'll need to start over.
</div>
{% endblock %}

{% block scripts %}
<script>
    // Enable/disable submit button based on selection
    function checkSelection() {
        const options = document.querySelectorAll('.answer-option');
        const submitBtn = document.getElementById('submitBtn');
        
        let isSelected = false;
        options.forEach(option => {
            if (option.checked) {
                isSelected = true;
            }
        });
        
        submitBtn.disabled = !isSelected;
    }

    // Timer functionality
    let timeLeft = 30;
    const timerElement = document.getElementById('timer');
    const timeTakenInput = document.getElementById('timeTaken');
    const form = document.getElementById('answerForm');
    
    const timer = setInterval(function() {
        timeLeft--;
        timerElement.textContent = timeLeft;
        timeTakenInput.value = 30 - timeLeft;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            // Only auto-submit if an option is selected
            const submitBtn = document.getElementById('submitBtn');
            if (!submitBtn.disabled) {
                form.submit(); // Auto-submit when time is up and an option is selected
            } else {
                // If no option selected when time runs out, skip the question
                window.location.href = "{{ url_for('main.skip_question') }}";
            }
        }
        
        // Change color when time is running out
        if (timeLeft <= 10) {
            timerElement.classList.replace('bg-primary', 'bg-danger');
        }
    }, 1000);
</script>
{% endblock %}