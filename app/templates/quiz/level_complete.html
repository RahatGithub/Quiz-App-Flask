{% extends 'base.html' %}

{% block title %}Level {{ level }} Complete{% endblock %}

{% block content %}
<div class="level-complete-container">
    <!-- Results Summary Card -->
    <div class="results-card card mb-5">
        <div class="card-header results-header text-center py-4">
            <div class="results-icon mb-3">
                {% if passed %}
                <i class="fas fa-trophy"></i>
                {% else %}
                <i class="fas fa-face-sad-tear"></i>
                {% endif %}
            </div>
            <h3 class="mb-0">
                {% if passed %}
                Congratulations! You passed Level {{ level }}
                {% else %}
                Level {{ level }} Complete
                {% endif %}
            </h3>
        </div>
        <div class="card-body text-center py-5">
            <div class="results-score-display mb-4">
                <div class="score-circle {% if passed %}score-passed{% else %}score-failed{% endif %}">
                    <span class="score-percentage">{{ percentage_points|round(0) }}%</span>
                    <span class="score-label">Score</span>
                </div>
            </div>
            
            <div class="results-stats row justify-content-center">
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-item">
                        <div class="stat-value">{{ total_correct }}/{{ total_questions }}</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-item">
                        <div class="stat-value">{{ score }}/{{ total_possible_points }}</div>
                        <div class="stat-label">Points Earned</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-item">
                        <div class="stat-value">{{ percentage_correct|round(1) }}%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
            </div>
            
            <div class="results-message mt-4">
                {% if passed and next_level %}
                <p class="lead">Great job! You've unlocked Level {{ next_level }}</p>
                <a href="{{ url_for('main.next_level', level=next_level) }}" class="btn btn-primary btn-lg mt-3">
                    Continue to Level {{ next_level }} <i class="fas fa-arrow-right ms-2"></i>
                </a>
                {% elif not passed %}
                <p class="lead">You need at least 60% to proceed to the next level.</p>
                <div class="mt-3">
                    <a href="{{ url_for('main.topics') }}" class="btn btn-primary me-2">
                        Try Again
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Detailed Question Report -->
    <h3 class="section-title mb-4">Question Breakdown</h3>

    {% for question in questions_detail %}
    <div class="question-review-card card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Question {{ loop.index }}</h5>
            <span class="status-badge {% if question.is_correct %}bg-success{% elif question.skipped %}bg-warning{% else %}bg-danger{% endif %}">
                {% if question.is_correct %}
                <i class="fas fa-check-circle me-1"></i> Correct
                {% elif question.skipped %}
                <i class="fas fa-forward me-1"></i> Skipped
                {% else %}
                <i class="fas fa-times-circle me-1"></i> Incorrect
                {% endif %}
            </span>
        </div>
        <div class="card-body">
            <p class="question-text">{{ question.text }}</p>
            
            <div class="options-review mt-3">
                {% for option in question.options %}
                <div class="option-review {% if option == question.correct_answer %}correct-answer{% endif %} {% if option == question.user_answer and not question.is_correct %}wrong-answer{% endif %}">
                    <span class="option-letter">{{ ['A', 'B', 'C', 'D'][loop.index0] }}</span>
                    <span class="option-text">{{ option }}</span>
                    
                    {% if option == question.correct_answer %}
                    <span class="option-status correct-mark"><i class="fas fa-check-circle"></i> Correct</span>
                    {% endif %}
                    
                    {% if option == question.user_answer and not question.is_correct %}
                    <span class="option-status wrong-mark"><i class="fas fa-times-circle"></i> Your Answer</span>
                    {% endif %}
                    
                    {% if option == question.user_answer and question.is_correct %}
                    <span class="option-status correct-mark"><i class="fas fa-check-circle"></i> Your Answer</span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <div class="points-earned mt-3">
                <span class="badge bg-secondary">Points: {{ question.points }}</span>
            </div>
        </div>
    </div>
    {% endfor %}

    {% if passed and next_level %}
    <div class="text-center mt-5">
        <a href="{{ url_for('main.next_level', level=next_level) }}" class="btn btn-primary btn-lg">
            Proceed to Level {{ next_level }} <i class="fas fa-arrow-right ms-2"></i>
        </a>
    </div>
    {% endif %}
</div>

<style>
    .level-complete-container {
        padding: 1rem 0;
    }
    
    .results-card {
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        border: none;
        overflow: hidden;
    }
    
    .results-header {
        background: linear-gradient(135deg, 
            {% if passed %}var(--primary){% else %}var(--secondary){% endif %} 0%, 
            {% if passed %}var(--secondary){% else %}var(--dark){% endif %} 100%);
        color: white;
        border: none;
    }
    
    .results-icon {
        font-size: 3rem;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .score-circle {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        border: 6px solid;
        transition: var(--transition);
    }
    
    .score-passed {
        background: rgba(76, 201, 240, 0.1);
        border-color: var(--success);
        color: var(--success);
    }
    
    .score-failed {
        background: rgba(247, 37, 133, 0.1);
        border-color: var(--accent);
        color: var(--accent);
    }
    
    .score-percentage {
        font-size: 2.5rem;
        font-weight: bold;
        line-height: 1;
    }
    
    .score-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .stat-item {
        text-align: center;
        padding: 1rem;
        background: rgba(67, 97, 238, 0.05);
        border-radius: var(--border-radius);
    }
    
    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }
    
    .section-title {
        color: var(--text-primary);
        font-weight: 600;
        position: relative;
        padding-bottom: 0.5rem;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        border-radius: 2px;
    }
    
    .question-review-card {
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        border: 1px solid rgba(67, 97, 238, 0.1);
        transition: var(--transition);
    }
    
    .question-review-card:hover {
        box-shadow: var(--shadow-md);
    }
    
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 500;
    }
    
    .question-text {
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
    }
    
    .options-review {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .option-review {
        padding: 0.8rem 1rem;
        border: 2px solid rgba(67, 97, 238, 0.1);
        border-radius: var(--border-radius);
        display: flex;
        align-items: center;
        transition: var(--transition);
    }
    
    .correct-answer {
        background: rgba(76, 201, 240, 0.1);
        border-color: var(--success);
    }
    
    .wrong-answer {
        background: rgba(247, 37, 133, 0.1);
        border-color: var(--accent);
    }
    
    .option-letter {
        background: var(--primary);
        color: white;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 1rem;
        flex-shrink: 0;
        font-size: 0.8rem;
    }
    
    .correct-answer .option-letter {
        background: var(--success);
    }
    
    .wrong-answer .option-letter {
        background: var(--accent);
    }
    
    .option-text {
        flex-grow: 1;
    }
    
    .option-status {
        font-weight: 500;
        margin-left: 1rem;
    }
    
    .correct-mark {
        color: var(--success);
    }
    
    .wrong-mark {
        color: var(--accent);
    }
    
    .points-earned {
        text-align: right;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .results-stats {
            gap: 1rem;
        }
        
        .stat-item {
            padding: 0.8rem;
        }
        
        .stat-value {
            font-size: 1.3rem;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
        }
        
        .score-percentage {
            font-size: 2rem;
        }
        
        .option-review {
            flex-wrap: wrap;
        }
        
        .option-status {
            margin-left: 0;
            width: 100%;
            margin-top: 0.5rem;
            padding-left: 2.5rem;
        }
    }
    
    @media (max-width: 576px) {
        .results-icon {
            font-size: 2.5rem;
        }
        
        .score-circle {
            width: 100px;
            height: 100px;
            border-width: 4px;
        }
        
        .score-percentage {
            font-size: 1.8rem;
        }
        
        .stat-value {
            font-size: 1.2rem;
        }
        
        .results-message .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .results-message .me-2 {
            margin-right: 0 !important;
        }
    }
</style>
{% endblock %}